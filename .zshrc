# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Powerlevel10k Instant Prompt (å³æ™‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
# .zshrc ã®èª­ã¿è¾¼ã¿ã‚’é«˜é€ŸåŒ–ã™ã‚‹ãŸã‚ã€zshèµ·å‹•æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’
# å…ˆã«è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚ˆã‚Šä¸Šã«è¨˜è¿°ã™ã¹ãã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å…¥åŠ›ã‚’
# å¿…è¦ã¨ã™ã‚‹åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ã®ã¿ã§ã™ã€‚(ä¾‹: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã€[y/n]ç¢ºèª)
#
if [ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Oh My Zsh (OMZ) ã®è¨­å®š
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# OMZ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‘ã‚¹
export ZSH="$HOME/.oh-my-zsh"

# OMZ ã®ãƒ†ãƒ¼ãƒè¨­å®š (Powerlevel10k ã‚’ä½¿ç”¨)
ZSH_THEME="powerlevel10k/powerlevel10k"

# OMZ ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š
plugins=(
  git                     # git ã‚³ãƒãƒ³ãƒ‰ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚„è£œå®Œ
  zsh-autosuggestions     # ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ã«åŸºã¥ãå…¥åŠ›å€™è£œã®è¡¨ç¤º
  zsh-syntax-highlighting # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®æ§‹æ–‡ãƒã‚¤ãƒ©ã‚¤ãƒˆ
)

# OMZ ã®åˆæœŸåŒ–
# â€» ã“ã®è¡Œã‚ˆã‚Šä¸‹ã§ $ZSH ã‚’ä½¿ã†è¨­å®šã‚„ OMZ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ä¾å­˜ã™ã‚‹è¨­å®šã‚’è¨˜è¿°
source $ZSH/oh-my-zsh.sh

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Powerlevel10k ã®è¨­å®šèª­ã¿è¾¼ã¿
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
# p10k ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (~/.p10k.zsh) ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
# è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã„å ´åˆã¯ `p10k configure` ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€
# ~/.p10k.zsh ã‚’ç›´æ¥ç·¨é›†ã—ã¦ãã ã•ã„ã€‚
#
[ ! -f ~/.p10k.zsh ] || source ~/.p10k.zsh

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ç’°å¢ƒå¤‰æ•° (Environment Variables)
# åŸºæœ¬çš„ã«ã¯.zshprofileã«è¨˜è¿°ã™ã‚‹ã€‚
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã‚¨ã‚¤ãƒªã‚¢ã‚¹ (Aliases) & é–¢æ•° (Functions)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Docker
alias dc='docker-compose'

# Git (åŸºæœ¬)
alias push='git push'
alias pull='git pull'
alias st='git stash'
alias ch='git checkout'
alias chp='git cherry-pick'

# Git (fzfé€£æº): ãƒ–ãƒ©ãƒ³ãƒã‚’ fzf ã§é¸æŠã—ã¦ checkout
# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãƒ–ãƒ©ãƒ³ãƒã®ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’è¡¨ç¤ºã€å…¥åŠ›æ¬„ã¯ä¸Šéƒ¨ã«è¡¨ç¤º
alias sw='git checkout $(git branch --sort=-committerdate --format="%(refname:short)|%(committerdate:relative)|%(subject)" |
  column -t -s "|" |
  fzf --exact \
      --no-sort \
      --prompt="BRANCH> " \
      --layout=reverse \
      --preview="git log --color --oneline --graph {1} -20" \
      --preview-window=right:60% \
  | awk "{print \$1}")'

# Git (é–¢æ•°): ã‚³ãƒ¼ãƒ‰å¤‰æ›´å±¥æ­´ (ç‰¹å®šã®æ–‡å­—åˆ—) ã‚’æ¤œç´¢
# Usage: gs <search_string> [file_path]
alias gs='(){git log -p -S $1 $2}'

# Git (é–¢æ•°): ãƒãƒ¼ã‚¸æ¸ˆã¿ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã‚’ä¸€æ‹¬å‰Šé™¤
alias gdb='delete-all-branch'
delete-all-branch() {
  # ãƒªãƒ¢ãƒ¼ãƒˆã®æœ€æ–°çŠ¶æ…‹ã‚’å–å¾—
  echo "ğŸ“¡ ãƒªãƒ¢ãƒ¼ãƒˆã®æœ€æ–°çŠ¶æ…‹ã‚’å–å¾—ä¸­..."
  git fetch --prune --quiet

  # å‰Šé™¤å¯¾è±¡ã®ãƒ–ãƒ©ãƒ³ãƒã‚’åé›†
  local branches_to_delete=$(
    {
      git branch --merged main 2>/dev/null
      git branch --merged master 2>/dev/null
      git branch --merged develop 2>/dev/null
    } | egrep -v '\*|develop|master|main' | sort -u
  )

  # å‰Šé™¤å¯¾è±¡ãŒãªã„å ´åˆ
  if [ -z "$branches_to_delete" ]; then
    echo "âœ… å‰Šé™¤å¯èƒ½ãªãƒãƒ¼ã‚¸æ¸ˆã¿ãƒ–ãƒ©ãƒ³ãƒã¯ã‚ã‚Šã¾ã›ã‚“"
    return 0
  fi

  # å‰Šé™¤å¯¾è±¡ã‚’è¡¨ç¤º
  echo "\nğŸ—‘ï¸  å‰Šé™¤å¯¾è±¡ã®ãƒ–ãƒ©ãƒ³ãƒ:"
  echo "$branches_to_delete" | sed 's/^/  â€¢ /'

  # ç¢ºèª
  echo -n "\nâ“ ã“ã‚Œã‚‰ã®ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ (y/N): "
  if read -q; then
    echo # æ”¹è¡Œ
    echo "\nğŸ”„ ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ä¸­..."

    # ãƒ–ãƒ©ãƒ³ãƒã‚’1ã¤ãšã¤å‰Šé™¤ï¼ˆé€²è¡ŒçŠ¶æ³ã‚’è¡¨ç¤ºï¼‰
    local count=0
    local total=$(echo "$branches_to_delete" | wc -l | tr -d ' ')

    echo "$branches_to_delete" | while read branch; do
      if [ -n "$branch" ]; then
        count=$((count + 1))
        git branch -d "$branch" 2>/dev/null
        echo "  [$count/$total] âœ“ $branch"
      fi
    done

    echo "\nâœ¨ å®Œäº†ï¼ $total å€‹ã®ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
  else
    echo # æ”¹è¡Œ
    echo "âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ"
  fi
}

# macOSå›ºæœ‰: trash-cliã‚’ä½¿ã£ãŸå®‰å…¨ãªrm
case "$OSTYPE" in
  darwin*)
    has() {
      which "$1" >/dev/null 2>&1
      return $?
    }
    if has trash; then
      alias rm='(){trash $*}'
    fi
    ;;
esac

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Zsh ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (setopt)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# cd æ™‚ã«è‡ªå‹•ã§ pushd ã‚’è¡Œã„ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚¿ãƒƒã‚¯ã«ç©ã‚€
setopt auto_pushd

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚¿ãƒƒã‚¯ã«é‡è¤‡ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç©ã¾ãªã„
setopt pushd_ignore_dups

# ã‚³ãƒãƒ³ãƒ‰ã®æ‰“ã¡é–“é•ã„ã‚’è¨‚æ­£ (correct)
setopt correct
SPROMPT="correct: %F{red}%R%f -> %F{green}%r%f ? [Yes/No/Abort/Edit] => "

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå±¥æ­´ (cdr - Recent Directories)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
# cdr ã‚³ãƒãƒ³ãƒ‰ã‚’æœ‰åŠ¹åŒ–ã—ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã‚‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå±¥æ­´ã‚’ä¿æŒã—ã¾ã™ã€‚
# 'cdr [Tab]' ã§å±¥æ­´ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
#
autoload -Uz add-zsh-hook
autoload -Uz chpwd_recent_dirs cdr
add-zsh-hook chpwd chpwd_recent_dirs

# cdr ã‚³ãƒãƒ³ãƒ‰ã§å±¥æ­´ã«ãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚‚ç§»å‹•å¯èƒ½ã«ã™ã‚‹
zstyle ":chpwd:*" recent-dirs-default true

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# fzf é€£æº (ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# ------------------------------------------------------------
# [Ctrl + R]: ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ (history) ã‚’ fzf ã§æ¤œç´¢
# ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿æŒ
# ------------------------------------------------------------
fzf-select-history() {
  BUFFER=$(history -n -r 1 |
    fzf --exact \
        --scheme=history \
        --tiebreak=index \
        --query="$LBUFFER" \
        --height=40% \
        --layout=reverse \
        --border \
        --prompt="HISTORY> ")
  CURSOR=$#BUFFER
  zle reset-prompt
}
zle -N fzf-select-history
bindkey '^r' fzf-select-history

# ------------------------------------------------------------
# [Ctrl + U]: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå±¥æ­´ (cdr) ã‚’ fzf ã§æ¤œç´¢ã—ã¦ cd
# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹ã‚’äº‹å‰ç¢ºèª
# ------------------------------------------------------------
fzf-cdr() {
  local destination="$(cdr -l |
    sed -e 's/^[[:digit:]]*[[:blank:]]*//' |
    sed "s|^~|$HOME|" |
    fzf --exact \
        --no-sort \
        --query="$LBUFFER" \
        --height=40% \
        --layout=reverse \
        --border \
        --prompt="DIR> " \
        --preview='ls -laG {} 2>/dev/null || echo "ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“"' \
        --preview-window=right:50%)"
  if [ -n "$destination" ]; then
    BUFFER="cd $destination"
    zle accept-line
  else
    zle reset-prompt
  fi
}
zle -N fzf-cdr
bindkey '^u' fzf-cdr

# ------------------------------------------------------------
# ãƒ—ãƒ­ã‚»ã‚¹æ¤œç´¢ãƒ»Kill
# ------------------------------------------------------------
# ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¤œç´¢ã—ã¦ kill (Space ã§è¤‡æ•°é¸æŠå¯èƒ½)
alias fkill='ps aux |
  fzf --header="Space: Mark | Enter: Kill selected" \
      --height=40% \
      --layout=reverse \
      --multi \
      --bind="space:toggle+down" \
      --preview="echo {}" \
      --preview-window=down:3:wrap |
  awk "{print \$2}" |
  xargs kill -9'

# ------------------------------------------------------------
# ç’°å¢ƒå¤‰æ•°ã®æ¤œç´¢
# ------------------------------------------------------------
# ç’°å¢ƒå¤‰æ•°ã‚’æ¤œç´¢ãƒ»è¡¨ç¤º
alias fenv='env | sort | fzf --height=40% \
               --layout=reverse \
               --preview="echo {}" \
               --preview-window=down:3:wrap'

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ãƒã‚·ãƒ³å›ºæœ‰è¨­å®šã®èª­ã¿è¾¼ã¿ (.zshrc_local)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
# ã“ã® .zshrc ãƒ•ã‚¡ã‚¤ãƒ«ã¯ dotfiles ã§ç®¡ç†ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
# APIã‚­ãƒ¼ã‚„ä¼šç¤¾PCç‰¹æœ‰ã®ãƒ—ãƒ­ã‚­ã‚·è¨­å®šãªã©ã€ãƒã‚·ãƒ³å›ºæœ‰ã®æ©Ÿå¯†æƒ…å ±ã¯
# .zshrc_local (dotfiles ç®¡ç†å¤–) ã«è¨˜è¿°ã—ã€ã“ã“ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚
#
[ -f $ZDOTDIR/.zshrc_local ] && . $ZDOTDIR/.zshrc_local
